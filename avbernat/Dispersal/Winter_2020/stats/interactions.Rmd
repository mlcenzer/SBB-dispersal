---
title: "Appendix: Modeling Wing Morphology"
author: "Bernat, AV, Cenzer, ML"
geometry: margin=2cm
fontsize: 12pt
line-height: 1.5
output:
  pdf_document:
    includes:
    toc: yes
    toc_depth: 3
classoption: a4paper
language: en
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Modeling Wing Morphology Summary File

\newpage

\begin{center}
\textbf{Panels C and D Regression Computations:}
\end{center}


```{r}
# scale/magnifications
c1 = 1.3*2 # size of points
c2 = 1.2*2 # size of large text
c3 = 2 # size of smaller text
c4 = 2*2 # size of title 
```

```{r}

## compute 95% confidence interval for a vector of data
calc_CI = function(vector, interval) {
  vec_sd = sd(vector)
  n = length(vector)
  vec_mean = mean(vector)
  # error according to t distribution
  error = qt((interval + 1)/2, df = n - 1) * vec_sd / sqrt(n)
  result = c("lower" = vec_mean - error, "upper" = vec_mean + error)
  return(result)
}

```

```{r}

## wing-to-body ratio
dw=aggregate(wing2body~sex, data=d, FUN=mean)

## wing-to-body ratio
dw$lower[1] = calc_CI(d[d$sex=="F",]$wing2body, 0.95)[1]
dw$lower[2] = calc_CI(d[d$sex=="M",]$wing2body, 0.95)[1]

dw$upper[1] = calc_CI(d[d$sex=="F",]$wing2body, 0.95)[2]
dw$upper[2] = calc_CI(d[d$sex=="M",]$wing2body, 0.95)[2]
```

```{r}
# tailoring variables for plotting
d$mass_block=round(d$avg_mass/0.005)*0.005 # 0.005 g blocks 
d$wing2body_block=round(d$wing2body, digits=2) # 0.01 blocks
d$days_block=round(d$avg_days, digits=0) # integer blocks
```



```{r echo=FALSE, fig.height=2.7*3, fig.width=6*3}

par(mfrow=c(1,2), mar = c(4.3, 7, 3.8, 0.1), cex.axis=c3, cex.lab=c2) 

# plot C (mass vs. flew_prob grouped by sex)
dm=aggregate(flew_prob~sex*mass_block, data=d, FUN=mean)
dm$n=aggregate(flew_prob~sex*mass_block, data=d, FUN=length)$flew_prob

d1 = dm[dm$sex=="F",]
d2 = dm[dm$sex=="M",]

# females
x=d1[,"mass_block"]
y=d1[,"flew_prob"] 
m1 = lm(y ~ x, data=d1)
shading=get_CI(x,y,m1)
mu_ci1=shading[[1]]
prd1=shading[[2]]

# males
x=d2[,"mass_block"]
y=d2[,"flew_prob"] 
m2 = lm(y ~ x, data=d2)
shading=get_CI(x,y,m2)
mu_ci2=shading[[1]]
prd2=shading[[2]]

plot(dm$flew_prob~dm$mass_block, 
     ylab="Flight probability", 
     xlab="Mass (g)", 
     pch=19, 
     col=sex_colors[as.factor(dm$sex)], 
     cex=c1,
     ylim=c(0,1), xlim=c(0.02, 0.18))
legend(0.14, 1, 
       legend=c("male", "female"), 
       col=c("blue", "red"),
       pch=19, 
       y.intersp=1.3, pt.cex=c1, cex = c2)
abline(m1, lty=2)
abline(m2, lty=2, col="darkblue")
shade(mu_ci1, lim = prd1$x)
shade(mu_ci2, lim = prd2$x, col=col.alpha("darkblue"))
pval1 = paste0("p = ", round(summary(m1)$coefficients[8],3), "*")
pval2 = paste0("p = ", round(summary(m2)$coefficients[8],2))
text(0.11, 0.5, pval1, cex=c2)
text(0.1, 0.9, pval2, cex=c2, col="darkblue")
mtext("C", side=3, adj=0, line=0.5, cex=c4, font=1)

# plot D (wing-to-body ratio grouped by sex)

plot(dw$wing2body~c(1,2), xaxt='n', 
     ylab="Wing-to-body ratio", 
     xlab="Sex", ylim=c(0.70,0.73), 
     xlim=c(0.5,2.5), 
     cex=c1, pch=19, col=sex_colors)
lines(x=xy.coords(x=c(1,1), y=c(dw$lower[1], dw$upper[1])), lwd=3, col=sex_colors[1])
lines(x=xy.coords(x=c(2,2), y=c(dw$lower[2], dw$upper[2])), lwd=3, col=sex_colors[2])
axis(side=1, at=c(1,2), labels=c("female", "male"))
mtext(text=c(nfem,nmale), at=c(1,2), side=1, line=-3, cex=c2)
mtext("D", side=3, adj=0, line=0.5, cex=c4, font=1)
```


```{r}


#Consider the scenario of a senior citizen with a 2 month tenure, with no internet service, a one year contract and a monthly charge of $100. If we compute all the effects and add them up we have 0.41 (Senior Citizen = Yes) - 0.06 (2*-0.03; tenure) + 0 (no internet service) - 0.88 (one year contract) + 0 (100*0; monthly charge) = -0.53.

# scenario = sex=F, host=1, months_since_start=1

MOY =  0.0995560
(1*-0.2597900) * 1* (1.1256358) + (1*-0.2597900) * 0.0107239 *0 + 1* (1.1256358) * MOY*12 + MOY*12 * 0.0107239 * 0


1 /(1 + exp(-0.1803651)) # 55% chance of being long-winged
1 /(1 + exp(0.6040815)) # 35% chance of being long-winged
1 /(1 + exp(1.052337)) # 25% change of being long-winged

# We then need to add the (Intercept), also sometimes called the constant, which gives us -0.53- 1.41 = -1.94

# add constant (the intercept) to beta (the effect)
prob = 1 / (1 + exp(-x)) 
prob = 1 /(1 + exp(- -1.94)) 
prob = 1 /(1 + exp(1.94)) #= 0.13 = 13%.
```


# Best Fits

```{r}
# months_since_start                0.0107239
# months_since_start:month_of_year -0.0014557
# sex_binom:months_since_start      0.0037212

year_coeff = 0.0107239
beta = year_coeff
per_change = (exp(beta) - 1) * 100 
per_change
```

```{r}
year_coeff = 0.0107239

beta = year_coeff
per_change = (exp(beta) - 1) * 100 
per_change
```

```{r}
# pophost_binom                     1.1256358 
# sex_binom:pophost_binom           0.0973323
# pophost_binom:month_of_year      -0.0379395 
host_coeff = 1.1256358

beta = host_coeff
per_change = (exp(beta) - 1) * 100 
per_change
```

```{r}
MOY_coeff = 0.0995560*1
#sex_coeff = -0.2597900*-1
inter_coeff = -0.0014557*72*1 
model =  MOY_coeff + inter_coeff 
beta = model
per_change = (exp(beta) - 1) * 100 
per_change # year over powers the months_since_start for the first month, but for all other months, seasonality drives the appearance of long-wing morphs

# plot this interaction...(1-12 for MOY_coeff and 0-72 for the year coeff)
```

```{r}
M = seq(1,12)
MSS = seq(0,72) # and you can project this and you'll see as the years proceed you would get WAY MORE PLASTICITY at later months

month_coeff = 0.0995560*M
year_coeff = -0.0014557*MSS # * M 
model = month_coeff + month_coeff * year_coeff

grid = expand.grid(month_coeff, year_coeff) # get combo of each month_coeff and year_coeff
grid$combo = grid$Var1 + (grid$Var1 * grid$Var2) # model

plot(grid$Var1, grid$combo, xlab="month effect", ylab="month effect + (month effect * year effect)", ylim=c(0,1.3)) # the variability is the year effect, later years go lower..., but over all as the months increase (as time progressing in general the later months become more extreme in terms of long-wing morph freq but the early months are the same as the last year) 

# early in the year, all the years have behaved more or less the same but now
# later in the year, the years have behaved more variability with long-wing morph chances varying across the temporal spectrum. **Where later years has less chances than before.**
# Have a lesser chance than previous years of being long-winged
# year acts as this amplifier/spreader of long-wing morph probability 
abline(h=0, col="red")
```

```{r}
M = seq(1,12)
MSS = seq(0,72) # and you can project this and you'll see as the years proceed you would get WAY MORE PLASTICITY at later months

c = expand.grid(M,MSS)
c$combos = c$Var1 * c$Var2
c$interaction_effect = -0.0014557 * c$combos
c$perchange = (exp(c$interaction_effect) - 1) * 100 
  
  
plot(c$Var1, c$interaction_effect, xlab="month effect", ylab="month effect * year effect")
plot(c$Var1, c$perchange, xlab="month effect", ylab="% change of month effect * year effect")
abline(h=0, col="red")


month_coeff = 0.0995560*M
m = expand.grid(c$interaction_effect, month_coeff)
m$model = m$Var1 + m$Var2
m$perchange =  (exp(m$model) - 1) * 100 

plot(m$Var2, m$perchange, xlab="month effect", ylab="month effect + (month effect * year effect)")
abline(h=0, col="red")
```

This should be parabolic because the negative effect of year gets so much more dramatic for month 12 vs month 1. And that flips for 



test... something is still wrong BUT YA KNOW - need to fix thisssss. It should be parabolic...where after a certain year then 

So I want to plot the model percentage change on the y-axis and then the year....so that early years show later months more likley.

* hard to graph...need to think more what I want to see.


```{r}
MOY_coeff = 0.0995560*1
#sex_coeff = -0.2597900*-1
inter_coeff = -0.0014557*69*1
model =  MOY_coeff + inter_coeff 
beta = model
per_change = (exp(beta) - 1) * 100 
per_change # year over powers the months_since_start for the first month, but for all other months, seasonality drives the appearance of long-wing morphs

# plot this interaction...(1-12 for MOY_coeff and 0-72 for the year coeff)
```


Less likely in later months than early months for LATER YEARS
But more likely in later months than later months for EARLY YEARS


but also less likely compared to earlier months. The inverse is true for early years. 


```{r fig.height=4, fig.width=5}

M = seq(1,12)
MSS = seq(0,72) # and you can project this and you'll see as the years proceed you would get WAY MORE PLASTICITY at later months
c = expand.grid(M,MSS)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    mo=c[i,1]
    yr=c[i,2]
    bm = 0.0995560
    bi = -0.0014557
    total_effect = bm*mo + bi*mo*yr
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}
MODEL = eq(c)
c$model = MODEL
colnames(c) = c("month", "year", "model")


library(plotrix)
set.seed(1)
x <- sort(runif(length(MSS), min = 0, max = 1))
colorfunc = colorRamp(c("blue","purple","red"))
mycolors_yr = rgb(colorfunc(x), maxColorValue=255)
x <- sort(runif(length(M), min = 0, max = 1))
mycolors_mo = rgb(colorfunc(x), maxColorValue=255)

par(mfrow=c(2,2))
plot(c$month, c$model, ylab="% change", xlab="month", col=mycolors_yr[as.factor(c$year)])
grid()
abline(h=0, col="black")
legend(1, 235, title="year", legend=c("2013", "2017", "2020"), col=c("blue","purple", "red"), pch=16)

plot(c$year, c$model, ylab="% change", xlab="months since start", col=mycolors_mo[as.factor(c$month)])
grid()
abline(h=0, col="black")
abline(v=69, col="black")
legend(50, 235, title="month", legend=c("1  ", "6  ", "12  "), col=c("blue","purple", "red"), pch=16)
text(55, 130, "year = 2019")


M = seq(1,12)
MSS = seq(0,72) # and you can project this and you'll see as the years proceed you would get WAY MORE PLASTICITY at later months
c = expand.grid(M,MSS)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    mo=c[i,1]
    yr=c[i,2]
    by = 0.0107239
    bi = -0.0014557
    total_effect = by*mo + bi*mo*yr
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}

MODEL = eq(c)
c$model = MODEL
colnames(c) = c("month", "year", "model")


library(plotrix)
set.seed(1)
x <- sort(runif(length(MSS), min = 0, max = 1))
colorfunc = colorRamp(c("blue","purple","red"))
mycolors_yr = rgb(colorfunc(x), maxColorValue=255)
x <- sort(runif(length(M), min = 0, max = 1))
mycolors_mo = rgb(colorfunc(x), maxColorValue=255)


plot(c$month, c$model, ylab="% change", xlab="month", col=mycolors_yr[as.factor(c$year)])
grid()
abline(h=0, col="black")
legend(1, -45, title="year", legend=c("2013", "2017", "2020"), col=c("blue","purple", "red"), pch=16)

plot(c$year, c$model, ylab="% change", xlab="months since start", col=mycolors_mo[as.factor(c$month)])
grid()
abline(h=0, col="black")
abline(v=7, col="black")
legend(12, -45, title="month", legend=c("1  ", "6  ", "12  "), col=c("blue","purple", "red"), pch=16)
text(15, -30, "year \n= \n2013")
```

Less likely in later months than early months for LATER YEARS
But more likely in later months than early months for EARLY YEARS


EARLY YEAR meant that LATE MONTH had most likely chance of being long winged BUT that ended soon after 2013 where across all months saw a decrease in long-wing morph appearance but you had the least decrease if you were in the early months. 


```{r}
sort(unique(raw_data$months_since_start)) # between 64 and 72...2018 and 2019 
```




```{r}
library(gridExtra)

p1 = gf_point(model ~ month, data=c, col=~year)
p2 = gf_point(model ~ year, data=c, col=~month)
grid.arrange(p1, p2, ncol=2)
```

```{r}
layout(matrix(1:2,nrow=1),widths=c(0.8,0.2))
#colfunc <- colorRampPalette(c("white","black"))
colfunc = colorRampPalette(c("blue","purple","red"))

par(mar=c(5.1,4.1,4.1,2.1))
plot(1:length(M),ann=FALSE,type="n")
grid()
points(1:length(M),col=colfunc(length(M)),pch=19,cex=1.5)

xl <- 1
yb <- 1.5
xr <- 1.3
yt <- 2

par(mar=c(5.1,0.5,4.1,0.5))
plot(NA,type="n",ann=FALSE,xlim=c(1,2),ylim=c(1,2),xaxt="n",yaxt="n",bty="n")
rect(xl,
     head(seq(yb,yt,(yt-yb)/10),-1),
     xr,
     tail(seq(yb,yt,(yt-yb)/10),-1),
     col=colfunc(length(M))
    )

mtext(1:length(M),side=2,at=tail(seq(yb,yt,(yt-yb)/10),-1)-0.05,las=2,cex=0.7)

```


As the years progressed 



```{r}
intercept = 0.7516501
MOY_coeff = 0.0995560*1
sex_coeff = -0.2597900*-1
host_coeff = 1.1256358
inter_coeff = -0.0014557*72*1 
model =  MOY_coeff + inter_coeff 
beta = host_coeff #+ intercept
per_change = (exp(beta) - 1) * 100 
per_change # year over powers the months_since_start for the first month, but for all other months, seasonality drives the appearance of long-wing morphs

# plot this interaction...(1-12 for MOY_coeff and 0-72 for the year coeff)
```

```{r}
# sex ----- 
# sex_binom:pophost_binom           0.0973323
# sex_binom:months_since_start      0.0037212 
# K. elegans"  "1" | F = 1 
S = c(1,-1)
HP = c(1,-1)
MSS = seq(0,72) # and you can project this and you'll see as the years proceed you would get WAY MORE PLASTICITY at later months
c = expand.grid(S, HP, MSS)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    sex=c[i,1]
    hp=c[i,2]
    yr=c[i,3]
    bsex = -0.2597900
    bshp = 0.0973323
    bsmss = 0.0037212
    total_effect = bsex * sex + (bshp * sex * hp) + (bsmss * sex * yr)
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}

MODEL = eq(c)
c$model = MODEL
colnames(c) = c("sex", "hp", "year", "model")

plot(c$year, c$model, ylab="% change", xlab="month",
     col=c("blue","red")[as.factor(c$sex)], pch=c(1,16)[as.factor(c$hp)],
     ylim = c(-30, 60))
grid()
abline(v=43, col="black")
abline(v=70, col="black")
legend(55, 60, legend=c("M + BV", "M + GRT", "F + GRT", "F + BV"), col=c("blue", "blue", "red", "red"), pch=c(1,16,16,1),cex=.7)
text(37, 50, "year = 2016", cex=.7)
text(64, 23, "year = 2019", cex=.7)
```



```{r}
# sex ----- 
# sex_binom:pophost_binom           0.0973323
# sex_binom:months_since_start      0.0037212 
# K. elegans"  "1" | F = 1 
intercept_var = 0.35216 
sexhp = 0.0037212 * 11
#sexmss = 0.0037212 * 1
beta = sexhp #+ intercept_var
per_change = (exp(beta) - 1) * 100 
per_change
```


```{r}
# pophost_binom                     1.1256358 
# sex_binom:pophost_binom           0.0973323 
# pophost_binom:month_of_year      -0.0379395 

S = c(1,-1)
HP = c(1,-1)
M = seq(1,12) # and you can project this and you'll see as the years proceed you would get WAY MORE PLASTICITY at later months
c = expand.grid(S, HP, M)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    sex=c[i,1]
    hp=c[i,2]
    m=c[i,3]
    bhp = 1.1256358 
    bshp = 0.0973323
    bhpm = -0.0379395 
    total_effect = bhp * hp + (bshp * sex * hp) + (bhpm * hp * m)
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}

MODEL = eq(c)
c$model = MODEL
colnames(c) = c("sex", "hp", "month", "model")

plot(c$month, c$model, ylab="% change", xlab="month",
     col=c("blue","red")[as.factor(c$sex)], pch=c(1,16)[as.factor(c$hp)], ylim=c(-80, 260))
grid()
abline(v=43, col="black")
abline(v=70, col="black")
legend(10.3, 260, legend=c("M + BV", "M + GRT", "F + GRT", "F + BV"), col=c("blue", "blue", "red", "red"), pch=c(1,16,16,1),cex=.7)
text(37, 50, "year = 2016", cex=.7)
text(64, 23, "year = 2019", cex=.7)
```


```{r}
# pophost_binom:month_of_year      -0.0379395 
hpm = -0.0379395 * -1 * 1 # larger for BV smaller for GRT
beta = hpm 
per_change = (exp(beta) - 1) * 100 
per_change

Probability = 1 / (1 + exp(beta)) * 100 # or p = exp(beta) / (1 + exp(beta))
Probability = exp(beta) / (1 + exp(beta)) * 100 
Probability
```

```{r}
HP = c(1,-1)
M = seq(1,12) # and you can project this and you'll see as the years proceed you would get WAY MORE PLASTICITY at later months
c = expand.grid(HP, M)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    hp=c[i,1]
    m=c[i,2]
    bhp = 1.1256358 
    bhpm = -0.0379395 
    total_effect = bhp * hp + (bhpm * hp * m)
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}

MODEL = eq(c)
c$model = MODEL
colnames(c) = c("hp", "month", "model")

plot(c$month, c$model, ylab="% change", xlab="month", pch=c(1,16)[as.factor(c$hp)], ylim=c(-80, 260))
grid()
abline(v=43, col="black")
abline(v=70, col="black")
legend(10.3, 260, legend=c("M + BV", "M + GRT", "F + GRT", "F + BV"), col=c("blue", "blue", "red", "red"), pch=c(1,16,16,1),cex=.7)
text(37, 50, "year = 2016", cex=.7)
text(64, 23, "year = 2019", cex=.7)

```


NO YOU DO NOT NEED THE INTERCEPT (plz follow this maths: https://online.stat.psu.edu/stat462/node/207/)

odds of sucesses = exp (b0 + b1x) and x is typically 1. If we increase the X by one unit then the odds ratio is just exp(b1)

(sunday)
1. Write about time, space, and plasticity for the SBB
2. Distance data tomorrow (just need to get a sense of the results)
(each night in the evenings this week)
1. Read 5 plasticity papers
2. Review 2 SBB papers 
3. Create a 30 slide presentation because 1 minute per slide kind of deal
4. plots and do distance analyses 












```{r}
min(dc$avg_mass_logsqrt)
max(dc$avg_mass_logsqrt)
seq(min(dc$avg_mass_logsqrt),max(dc$avg_mass_logsqrt), by = 0.01)
seq(min(dc$avg_mass),max(dc$avg_mass), by = 0.01)
```


```{r fig.height=1.7, fig.width=2}
# sex ----- 
# sex_binom:pophost_binom           0.0973323
# sex_binom:months_since_start      0.0037212 
# K. elegans"  "1" | F = 1 
HP = c(1,-1)
M = seq(min(dc$avg_mass_logsqrt),max(dc$avg_mass_logsqrt), by = 0.01)
MT = seq(min(dc$avg_mass),max(dc$avg_mass), by = 0.01)
c = expand.grid(HP,M)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    hp=c[i,1]
    ma=c[i,2]
    bsi = 1.85594 # exp((1.85594^2))
    total_effect = bsi * hp * ma 
    detransform = exp((total_effect^2))
    pprob = exp(detransform)
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}

MODEL = eq(c)
c$model = MODEL
colnames(c) = c("hp", "avg_mass_logsqrt", "model")

xlabel = expression(log(sqrt(avg("mass"))))
#xlabel = "average mass (g)"
# "log square root average mass (g)"

plot(c$avg_mass_logsqrt, c$model, ylab="% change", xlab=xlabel,
     col=c("skyblue","green3")[as.factor(c$hp)], pch=c(16,16)[as.factor(c$hp)])
grid()
abline(v=0, col="black")
abline(v=70, col="black")
legend(0.1, 210, legend=c("C. corindum", "K. elegans"), col=c("skyblue", "green3"), pch=c(16,16),cex=.7)
text(37, 50, "year = 2016", cex=.7)
text(64, 23, "year = 2019", cex=.7)
```


```{r}
daa=aggregate(flew_prob~avg_mass_logsqrt*host_plant, data=dc, FUN=mean)
plot(dc$avg_mass_logsqrt, dc$flew_prob)
```

```{r fig.height=1.7, fig.width=2}
# sex ----- 
# sex_binom:pophost_binom           0.0973323
# sex_binom:months_since_start      0.0037212 
# K. elegans"  "1" | F = 1 

SIM = seq(min(dc$sym_dist_s), max(dc$sym_dist_s), by = 0.1)
M = seq(min(dc$avg_mass_logsqrt),max(dc$avg_mass_logsqrt), by = 0.01)
MT = seq(min(dc$avg_mass),max(dc$avg_mass), by = 0.01)
c = expand.grid(SIM,M)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    sim=c[i,1]
    ma=c[i,2]
    bsi = -1.36386 # exp((1.85594^2))
    total_effect = bsi * sim * ma 
    detransform = exp((total_effect^2))
    pprob = exp(detransform)
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}

MODEL = eq(c)
c$model = MODEL
colnames(c) = c("sym_dist", "avg_mass_logsqrt", "model")

xlabel = expression(log(sqrt(avg("mass"))))
#xlabel = "average mass (g)"
# "log square root average mass (g)"

library(plotrix)
colorfunc = colorRamp(c("skyblue","blue","grey78"))
x <- sort(runif(length(SIM), min = 0, max = 1))
mycolors_sim = rgb(colorfunc(x), maxColorValue=255)

plot(c$avg_mass_logsqrt, c$model, ylab="% change", xlab=xlabel,
     col=mycolors_sim[as.factor(c$sym_dist)])
grid()
abline(v=0, col="black")
abline(v=70, col="black")
legend(0.1, 260, title="Distance from Sympatric Zone", 
       legend=c("Close", "Homestead", "Far"),
       col=c("skyblue","blue","grey78"), pch=c(16,16,16),cex=.7)
text(37, 50, "year = 2016", cex=.7)
text(64, 23, "year = 2019", cex=.7)
```


```{r}
unique(cbind(dc$sym_dist, dc$sym_dist_s, dc$population, dc$host_plant))
```


```{r fig.height=1.7, fig.width=2}
# sex ----- 
# sex_binom:pophost_binom           0.0973323
# sex_binom:months_since_start      0.0037212 
# K. elegans"  "1" | F = 1 

HP = c(1,-1)
SIM = seq(min(dc$sym_dist_s), max(dc$sym_dist_s), by = 0.5)
SIM = unique(dc$sym_dist_s)
M = seq(min(dc$avg_mass_logsqrt),max(dc$avg_mass_logsqrt), by = 0.05)
MT = seq(min(dc$avg_mass),max(dc$avg_mass), by = 0.01)
c = expand.grid(HP,SIM,M)

eq = function(combo_matrix) {
  effects_col = c()
  for (i in 1:nrow(c)) {
    hp=c[i,1]
    sim=c[i,2]
    ma=c[i,3]
    bih = 1.85594
    bis = -1.36386 # exp((1.85594^2))
    total_effect = (bis * sim * ma) + (bih * hp * ma)
    detransform = exp((total_effect^2))
    pprob = exp(detransform)
    perchange =  (exp(total_effect) - 1) * 100 
    effects_col = c(effects_col, perchange)
  }
  
  return(effects_col)
}

MODEL = eq(c)
c$model = MODEL
colnames(c) = c("host", "sym_dist", "avg_mass_logsqrt", "model")
c$index = seq(1,nrow(c), by=1)

temp = c[c$sym_dist == unique(c$sym_dist)[9],]
rows_to_remove = temp[temp$host == unique(c$host)[2],]$index # remove BV in Homestead

temp = c[c$sym_dist > unique(c$sym_dist)[2],]
rows_to_remove3 = temp[temp$host == unique(c$host)[2],]$index # remove BV in mainland

temp = c[c$sym_dist > unique(c$sym_dist)[9],]
temp2 = temp[temp$sym_dist < unique(c$sym_dist)[10],] 
temp3 = temp2[temp2$host == unique(c$host)[1],] # remove GRT in the keys
rows_to_remove2 = temp3$index


remove_rows = c(rows_to_remove, rows_to_remove2, rows_to_remove3)

cf = c[-remove_rows,]

cf[order(cf$sym_dist),] 

```

```{r}
cf
```

```{r}
(unique(cf$sym_dist))[5]
unique(cf$sym_dist)[1]
```

```{r fig.height=2.4, fig.width=2.7}
xlabel = expression(log(sqrt(avg("mass (g)"))))
#xlabel = "distance from sympatric zone"
# "log square root average mass (g)"

cft = cf[cf$host == -1,] # -1 is C.corindum
#cft = cf[cf$sym_dist == min(unique(cf$sym_dist)),]
#cft = cf[cf$sym_dist == (unique(cf$sym_dist))[5],]
#cft = cf[cf$sym_dist == (unique(cf$sym_dist))[1],]
#cft= cf

cols = c("green","darkgreen","grey78")
cols = c("skyblue","blue","grey78")
#cols = c("skyblue","black","green")
library(plotrix)
colorfunc = colorRamp(cols)
#colorfunc = colorRamp(c("red","black","blue"))
x <- sort(runif(length(SIM), min = 0, max = 1))
mycolors_sim = rgb(colorfunc(x), maxColorValue=255)

plot(cft$avg_mass_logsqrt, cft$model, ylab="% change", xlab=xlabel,
     col=mycolors_sim[as.factor(cft$sym_dist)],pch=c(2,2)[as.factor(cft$host)],
     ylim=c(-100,550)
    # ,cex=abs(cft$sym_dist)*.8
     )
grid()
abline(v=0, col="black")
abline(v=70, col="black")
legend(.05, 550,
       legend=c("K. elegans", "C. corindum"),
       col=c("black"), pch=c(1,2),cex=1)
legend(.05, 400,
       legend=c("Far", "Homestead", "Close"),
       col=cols, pch=c(20, 20, 19),cex=1)
```


```{r fig.height=2.4, fig.width=2.7}
xlabel = expression(log(sqrt(avg("mass (g)"))))
#xlabel = "distance from sympatric zone"
# "log square root average mass (g)"

cft = cf[cf$host == 1,] # -1 is C.corindum
#cft = cf[cf$sym_dist == min(unique(cf$sym_dist)),]
#cft = cf[cf$sym_dist == (unique(cf$sym_dist))[5],]
#cft = cf[cf$sym_dist == (unique(cf$sym_dist))[1],]
cft= cf

cols = c("green","darkgreen","grey78")
#cols = c("skyblue","blue","grey78")
cols = c("pink","black","grey")
library(plotrix)
colorfunc = colorRamp(cols)
#colorfunc = colorRamp(c("red","black","blue"))
x <- sort(runif(length(SIM), min = 0, max = 1))
mycolors_sim = rgb(colorfunc(x), maxColorValue=255)

plot(cft$avg_mass_logsqrt, cft$model, ylab="% change", xlab=xlabel,
     col=mycolors_sim[as.factor(cft$sym_dist)],pch=c(1,2)[as.factor(cft$host)],
     ylim=c(-100,550)
    # ,cex=abs(cft$sym_dist)*.8
     )
grid()
abline(v=0, col="black")
abline(v=70, col="black")
legend(.05, 550,
       legend=c("K. elegans", "C. corindum"),
       col=c("black"), pch=c(1,2),cex=1)
legend(.05, 400,
       legend=c("Far", "Homestead", "Close"),
       col=cols, pch=c(20, 20, 20),cex=1)
```
```{r}
cols = c("green","darkgreen","grey78")
library(plotrix)
colorfunc = colorRamp(cols)
#colorfunc = colorRamp(c("red","black","blue"))
x <- sort(runif(length(SIM), min = 0, max = 1))
mycolors_sim = rgb(colorfunc(x), maxColorValue=255)

plot(cf$sym_dist, cf$model, ylab="% change", xlab=xlabel,
     col=mycolors_sim[as.factor(cf$avg_mass_logsqrt)],pch=c(1,2)[as.factor(cf$host)],
     cex=abs(cf$sym_dist)*.9)
grid()
abline(v=0, col="black")
abline(v=70, col="black")
legend(.05, 550,
       legend=c("K. elegans", "C. corindum"),
       col=c("black"), pch=c(1,2),cex=1)
legend(.05, 400,
       legend=c("Close", "Homestead", "Far"),
       col=cols, pch=c(20, 20, 19),cex=1)
```

```{r}
(exp(.46077) - 1) * 100 
```



