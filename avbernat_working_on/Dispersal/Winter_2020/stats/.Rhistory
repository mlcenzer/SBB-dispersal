kable_styling(bootstrap_options = "striped", "hover", full_width = F)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c(" ", " ", "Key" = 3 ))
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Key" = 1 ))
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Key" = 2 ))
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Delta Flight Response Key" = 2 ))
# key
Event = c("flew in T2 but not T1", " flew in T1 and T2 or in neither trial", "flew in T1 but not T2")
Encoding = c(1,0,-1)
key = cbind(Event, Encoding)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Delta Flight Response Key" = 2 ))
rm(list=ls())
dir = "~/Desktop/git_repositories/SBB-dispersal/avbernat_working_on/Dispersal/Winter_2020/stats/"
setwd(dir)
library(lme4)
library(dplyr)
# library(ggplotify)
# library(gridExtra)
# library(ggformula)
# library(tidyselect)
# library(zoo)
library(nnet) # multinom package
# tables
library(knitr)
library(kableExtra)
# plotting
library(rethinking)
knitr::opts_chunk$set(echo = TRUE)
# key = response in T2 - response in T1
Event = c("flew in T2 but not T1", " flew in T1 and T2 or in neither trial", "flew in T1 but not T2")
Encoding = c(1,0,-1)
key = cbind(Event, Encoding)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Delta Flight Response Key" = 2 ))
output_col = FALSE # Change to TRUE if working in Base R or RStudio; FALSE if generating an HTML
source("src/clean_flight_data.R") # Loads and cleans data
source("src/regression_output.R") # Cleans regression outputs; prints in color or black & white
source("src/center_flight_data.R") # Re-centers data
source("src/get_warnings.R")
data <- read_flight_data("data/all_flight_data-Winter2020.csv")
data_all <- data[[1]]
data_tested <- data[[2]]
d <- data_tested %>%
group_by(ID, sex,population, site, host_plant, latitude, longitude, total_eggs,
beak, thorax, wing, body, w_morph, morph_notes, tested,
host_c, sex_c, w_morph_c, lat_c, sym_dist, sym_dist_s, total_eggs_c,
beak_c, thorax_c, thorax_s, body_c, wing_c, wing2body, wing2body_c, wing2body_s) %>%
summarise_all(funs(list(na.omit(.))))
d$num_flew <- 0
d$num_notflew <- 0
d$average_mass <- 0
d$mass_diff <- 0
d$flew_diff <- 0
d$dist_diff <- 0
d$speed_diff <- 0
for(row in 1:length(d$flew_b)){
n_flew <- sum(d$flew_b[[row]] == 1) # total number of times did fly among trails
d$num_flew[[row]] <- n_flew
n_notflew <- sum(d$flew_b[[row]] == 0) # total number of times did not fly among trails
d$num_notflew[[row]] <- n_notflew
avg_mass <- mean(d$mass[[row]])
d$average_mass[[row]] <- avg_mass
# mass, flight, distance, and speed changes between T1 and T2
d$mass_diff[[row]] <- d$mass[[row]][2] - d$mass[[row]][1]  # T2 - T1
d$flew_diff[[row]] <- d$flew_b[[row]][2] - d$flew_b[[row]][1]  # T2 - T1
d$dist_diff[[row]] <- d$distance[[row]][2] - d$distance[[row]][1]  # T2 - T1
d$speed_diff[[row]] <- d$average_speed[[row]][2] - d$average_speed[[row]][1]  # T2 - T1
d$egg_diff[[row]] <- d$eggs_b[[row]][2] - d$eggs_b[[row]][1]  # T2 - T1
}
d <- select(d, -filename, -channel_letter, -set_number)
d # NA's generated are good because that means it's accounted only for bugs that flew in both trials
### AB: NOTE this includes also bugs that only flew in T1 so if we want to constrict it to bugs that flew in T1 and T2 we would need to adjust for that. If want to do that just uncomment the following:
# Filter out bugs that ONLY flew in T1:
# rows_remove <- c()
# for (row in 1:nrow(d)){
#   if (length(d$trial_type[[row]]) < 2) {
#     rows_remove <- c(rows_remove, row)
#   }
# }
# d <- d[-rows_remove, ]
# d
d <- data_tested %>%
group_by(ID, sex,population, site, host_plant, latitude, longitude, total_eggs,
beak, thorax, wing, body, w_morph, morph_notes, tested,
host_c, sex_c, w_morph_c, lat_c, sym_dist, sym_dist_s, total_eggs_c,
beak_c, thorax_c, thorax_s, body_c, wing_c, wing2body, wing2body_c, wing2body_s) %>%
summarise_all(funs(list(na.omit(.))))
d$num_flew <- 0
d$num_notflew <- 0
d$average_mass <- 0
d$egg_diff <- 0
d$mass_diff <- 0
d$flew_diff <- 0
d$dist_diff <- 0
d$speed_diff <- 0
for(row in 1:length(d$flew_b)){
n_flew <- sum(d$flew_b[[row]] == 1) # total number of times did fly among trails
d$num_flew[[row]] <- n_flew
n_notflew <- sum(d$flew_b[[row]] == 0) # total number of times did not fly among trails
d$num_notflew[[row]] <- n_notflew
avg_mass <- mean(d$mass[[row]])
d$average_mass[[row]] <- avg_mass
# mass, flight, distance, and speed changes between T1 and T2
d$mass_diff[[row]] <- d$mass[[row]][2] - d$mass[[row]][1]  # T2 - T1
d$flew_diff[[row]] <- d$flew_b[[row]][2] - d$flew_b[[row]][1]  # T2 - T1
d$dist_diff[[row]] <- d$distance[[row]][2] - d$distance[[row]][1]  # T2 - T1
d$speed_diff[[row]] <- d$average_speed[[row]][2] - d$average_speed[[row]][1]  # T2 - T1
d$egg_diff[[row]] <- d$eggs_b[[row]][2] - d$eggs_b[[row]][1]  # T2 - T1
}
d <- select(d, -filename, -channel_letter, -set_number)
d # NA's generated are good because that means it's accounted only for bugs that flew in both trials
### AB: NOTE this includes also bugs that only flew in T1 so if we want to constrict it to bugs that flew in T1 and T2 we would need to adjust for that. If want to do that just uncomment the following:
# Filter out bugs that ONLY flew in T1:
# rows_remove <- c()
# for (row in 1:nrow(d)){
#   if (length(d$trial_type[[row]]) < 2) {
#     rows_remove <- c(rows_remove, row)
#   }
# }
# d <- d[-rows_remove, ]
# d
rows_remove <- c()
for (row in 1:nrow(d)){
if (length(d$trial_type[[row]]) < 2) {
rows_remove <- c(rows_remove, row)
}
}
d <- d[-rows_remove, ]
d
d
# select for columns only needed in these analyses
d
d
df <- d %>%
filter(!is.na(mass_diff), !is.na(flew_diff))
df <- df[with(df, order(mass_diff)),]
df$flew_diff <- relevel(as.factor(df$flew_diff), ref = "0")
null <- multinom(flew_diff ~ 1, data = df)
model <- multinom(flew_diff ~ mass_diff, data = df)
# compute p-values using Wald tests (i.e. z-tests)
s <- summary(model)
z <- s$coefficients/s$standard.errors
wald <- z^2
p <- (1 - pnorm(abs(z), 0, 1)) * 2
table <- cbind(s$coefficients, c(s$edf, s$edf), s$standard.errors[,2], z[,2], wald[,2], p[,2])
colnames(table) <- c("(Intercept)"," Estimate","DF", "Std. Err.", "z", "wald", "P > |z|")
cat("\n")
cat("AIC: ", s$AIC, "\n")
table
anova(null, model, test="Chisq") # adding mass_diff improves fit
nrow(df)
n_trials = nrow(df)
model
model$cal
model$call
eq = "delta_response = 1.4 + 57.4 mass_diff"
eq = "delta_response (T1 vs. T2) = 1.4 + 57.4 mass_diff"
cbind(n_trials, eq)
t = cbind(n_trials, eq)
colnames(t) = c("N","Equation")
t
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Best Fit" = 2 ))
eq = "flew in T1 rather than T2 = 1.4 + 57.4 mass_diff"
t = cbind(n_trials, eq)
colnames(t) = c("N","Equation")
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Best Fit" = 2 ))
eq = "Flew in T1 rather than T2 = 1.4 + 57.4 Mass Change"
t = cbind(n_trials, eq)
colnames(t) = c("N","Equation")
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Best Fit" = 2 ))
eq = "Flew in T1 rather than T2  =  1.4 + 57.4 Mass Change"
t = cbind(n_trials, eq)
colnames(t) = c("N","Equation")
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Best Fit" = 2 ))
eq = "Flew in T1 rather than T2 = 1.4 + 57.4 Mass Change"
t = cbind(n_trials, eq)
colnames(t) = c("N","Model")
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Best Fit" = 2 ))
# key = change in mass
Event = c("gained mass from T1 to T2", "no mass change between trails", "lost mass from T1 to T2")
Encoding = c("-","0","+")
key = cbind(Event, Encoding)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Delta Mass Key" = 2 ))
# key = change in mass
Event = c("gained mass from T1 to T2", "no mass change between trails", "lost mass from T1 to T2")
Sign = c("+","0","-")
key = cbind(Event, Sign)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Delta Mass Key" = 2 ))
exp(52.85/50)
exp(coef(model)/50)
head(pp <- fitted(model))
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.035, lty=2)
abline(v=-0.027, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.033, lty=2)
abline(v=-0.027, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.032, lty=2)
abline(v=-0.027, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.032, lty=2)
abline(v=-0.025, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.032, lty=2)
abline(v=-0.023, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.032, lty=2)
abline(v=-0.0235, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.032, lty=2)
abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
#text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
#text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.032, lty=2)
abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
#points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
#points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
#text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
#text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
abline(v=0.032, lty=2)
abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
#points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
#points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
#text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
#text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
#abline(v=0.032, lty=2)
#abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
#points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
#text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
#abline(v=0.032, lty=2)
#abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="green")
#abline(v=0.032, lty=2)
#abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="darkgreen")
#abline(v=0.032, lty=2)
#abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="darkgreen", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="darkgreen")
#abline(v=0.032, lty=2)
#abline(v=-0.024, lty=2)
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="l", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="l") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="darkgreen", type="l") # flew in T2 but not T1
text(0.02,0.8, labels="No Flight Diff", col="red")
text(0.0,0.35, labels="Flew in T1 but not T2", col="blue")
text(0.02,0.1, labels="Flew in T2 but not T1", col="darkgreen")
abline(v=0.032, lty=2)
abline(v=-0.024, lty=2)
data <- data.frame(R = df$flew_diff,
A = df$mass_diff,
B = df$host_c,
C = df$sex_c)
source("src/compare_models.R")
model_comparisonsAIC("src/generic multinomial models- multinom 1RF + 3 FF.R")
anova(m5, m7, test="Chisq") # Adding B does not improve fit
anova(m5, m9, test="Chisq") # Adding A*C does not improve fit
anova(m2, m5, test="Chisq")
anova(m1, m5, test="Chisq")
anova(m3, m5, test="Chisq")
delta_mass_model <- multinom(flew_diff ~ mass_diff + sex_c, data = df)
# compute p-values using Wald tests (i.e. z-tests)
s <- summary(delta_mass_model)
z <- s$coefficients/s$standard.errors
wald <- z^2
p <- (1 - pnorm(abs(z), 0, 1)) * 2
# summary table (similar to lm, glm, or lmer function)
table <- cbind(s$coefficients, c(s$edf, s$edf), s$standard.errors[,2:3], z[,2:3], wald[,2:3], p[,2:3])
colnames(table) <- c("(Intercept)","coeff mass_diff", "coeff sex_c","DF",
"MD SE", "sex SE", "MD z", "sex z",
"MD wald","sex wald","MD P > |z|", "sex P > |z|")
cat("\n", "AIC: ", s$AIC, "\n", "MD = mass_diff", "\n")
table
delta_mass_model <- multinom(flew_diff ~ mass_diff + sex_c, data = df)
# compute p-values using Wald tests (i.e. z-tests)
s <- summary(delta_mass_model)
z <- s$coefficients/s$standard.errors
wald <- z^2
p <- (1 - pnorm(abs(z), 0, 1)) * 2
# summary table (similar to lm, glm, or lmer function)
table <- cbind(s$coefficients, c(s$edf, s$edf), s$standard.errors[,2:3], z[,2:3], wald[,2:3], p[,2:3])
colnames(table) <- c("(Intercept)","coeff mass_diff", "coeff sex_c","DF",
"MD SE", "sex SE", "MD z", "sex z",
"MD wald","sex wald","MD P > |z|", "sex P > |z|")
cat("\n", "AIC: ", s$AIC, "\n", "MD = mass_diff", "\n")
table
delta_mass_model <- multinom(flew_diff ~ mass_diff + sex_c, data = df)
# compute p-values using Wald tests (i.e. z-tests)
s <- summary(delta_mass_model)
z <- s$coefficients/s$standard.errors
wald <- z^2
p <- (1 - pnorm(abs(z), 0, 1)) * 2
# summary table (similar to lm, glm, or lmer function)
table <- cbind(s$coefficients, c(s$edf, s$edf), s$standard.errors[,2:3], z[,2:3], wald[,2:3], p[,2:3])
colnames(table) <- c("(Intercept)","coeff mass_diff", "coeff sex_c","DF",
"MD SE", "sex SE", "MD z", "sex z",
"MD wald","sex wald","MD P > |z|", "sex P > |z|")
cat("\n", "AIC: ", s$AIC, "\n", "MD = mass_diff", "\n")
table
exp((117.12+6.06)/50)
eq = "Flew in T1 rather than T2 = 1.4 + 57.4 Mass Change"
t = cbind(n_trials, eq)
colnames(t) = c("N","Model")
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)
eq = "Flew in T1 rather than T2 = 7.04 + 117.12 Mass Change + 6.06 Sex"
t = cbind(n_trials, eq)
colnames(t) = c("N","Model")
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)
exp((117.12+6.06)/50)
exp((117.12-6.06)/50)
exp(coef(delta_mass_model)/50)
head(pp <- fitted(delta_mass_model))
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="b", ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="b") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="green", type="b") # flew in T2 but not T1
text(0.031,0.8, labels="No Flight Diff", col="red")
text(0.008,0.5, labels="Flew in T1 but not T2", col="blue")
text(0.052,0.1, labels="Flew in T2 but not T1", col="green")
# female line is always higher
text(0.0,0.96, labels="F", col="red")
text(0.0,0.7, labels="M", col="red")
text(0.0,0.25, labels="F", col="blue")
text(0.02,0.2, labels="M", col="blue")
text(-0.03,0.25, labels="F", col="green")
text(0.025,0.05, labels="M", col="green")
abline(v=0.03, lty=2, col="slategrey")
abline(v=0.035, lty=2, col="slategrey")
abline(v=0.04, lty=2, col="slategrey")
abline(v=-0.01, lty=2, col="slategrey")
abline(v=-0.045, lty=2, col="slategrey")
plot(df$mass_diff, pp[,1], ylim=c(0,1), col="red", type="b",
ylab="Predicted Probability", xlab="Changes in Mass From T1 to T2 (g)") # no flight_diff
points(df$mass_diff, pp[,2], col="blue", type="b") # flew in T1 but not T2
points(df$mass_diff, pp[,3], col="darkgreen", type="b") # flew in T2 but not T1
text(0.031,0.8, labels="No Flight Diff", col="red")
text(0.008,0.5, labels="Flew in T1 but not T2", col="blue")
text(0.052,0.1, labels="Flew in T2 but not T1", col="darkgreen")
# female line is always higher
text(0.0,0.96, labels="F", col="red")
text(0.0,0.7, labels="M", col="red")
text(0.0,0.25, labels="F", col="blue")
text(0.02,0.2, labels="M", col="blue")
text(-0.03,0.25, labels="F", col="darkgreen")
text(0.025,0.05, labels="M", col="darkgreen")
abline(v=0.03, lty=2, col="slategrey")
abline(v=0.035, lty=2, col="slategrey")
abline(v=0.04, lty=2, col="slategrey")
abline(v=-0.01, lty=2, col="slategrey")
abline(v=-0.045, lty=2, col="slategrey")
df <- d %>%
filter(!is.na(egg_diff), !is.na(flew_diff), sex_c == 1)
df$flew_diff <- relevel(as.factor(df$flew_diff), ref = "0")
null <- multinom(flew_diff ~ 1, data = df)
model <- multinom(flew_diff ~ egg_diff, data = df)
# compute p-values using Wald tests (i.e. z-tests)
s <- summary(model)
z <- s$coefficients/s$standard.errors
wald <- z^2
p <- (1 - pnorm(abs(z), 0, 1)) * 2
# summary table (similar to lm, glm, or lmer function)
table <- cbind(s$coefficients, c(s$edf, s$edf), s$standard.errors[2], z[2], wald[2], p[2])
colnames(table) <- c(" Estimate","DF", "Std. Err.", "z", "wald", "P > |z|")
cat("\n")
cat("AIC: ", s$AIC, "\n")
table
n_tfemales = nrow(df)
anova(null, model, test="Chisq") # adding egg_diff improves fit
df <- df[!is.na(df$mass_diff),]
n_tfemales = nrow(df)
# key = response in T2 - response in T1
Event = c("flew in T1 but not T2", "flew in T1 and T2 or in neither trial", )
# key = response in T2 - response in T1
Event = c("flew in T1 but not T2", "flew in T1 and T2 or in neither trial")
Encoding = c(1,0)
key = cbind(Event, Encoding)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Binomial Flight Response Key" = 2 ))
R = df$flew_diff
A = df$egg_diff
B = df$mass_diff
#C = df$sym_dist
C = df$host_c
data<-data.frame(R, A, B, C)
source("src/compare_models.R")
model_comparisonsAIC("src/generic models-binomial glm 3-FF.R")
anova(m7, m12, test="Chisq") # Adding A*C does not improve fit
anova(m6, m7, test="Chisq") # Addin A does improve fit
delta_egg_model <- glm(flew_diff ~ egg_diff + mass_diff + host_c, family = binomial, data = df)
tidy_regression(delta_egg_model, is_color = output_col)
gf_point(flew_diff ~ mass_diff, data=df, col=~egg_diff)
# key = response in T2 - response in T1
Event = c("flew in T1 only", "flew in T1 and T2 or in neither trial")
Encoding = c(1,0)
key = cbind(Event, Encoding)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Binomial Flight Response Key" = 2 ))
summary(delta_egg_model)
eq = "Flew in T1 only = -2.2 + 1.4 Egg Change + 40.2 Mass Change + 0.72 Host Plant"
t = cbind(n_tfemales, eq)
colnames(t) = c("N","Model")
kable(t) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)
delta_egg_model <- glm(flew_diff ~ egg_diff + mass_diff + host_c, family = binomial, data = df)
tidy_regression(delta_egg_model, is_color = output_col)
A
R = df$flew_diff
A = df$egg_diff
B = df$mass_diff
#C = df$sym_dist
C = df$host_c
data<-data.frame(R, A, B, C)
source("src/compare_models.R")
model_comparisonsAIC("src/generic models-binomial glm 3-FF.R")
# key = response in T2 - response in T1
Event = c("laid eggs in T2 but not T1", "laid eggs T1 and T2 or neither trials", "laid eggs in T1 but not T2")
Encoding = c(1,0,-1)
key = cbind(Event, Encoding)
kable(key) %>%
kable_styling(bootstrap_options = "striped", "hover", full_width = F)  %>%
add_header_above(c("Delta Flight Response Key" = 2 ))
gf_point(flew_diff ~ mass_diff, data=df, col=~egg_diff)
View(m1)
